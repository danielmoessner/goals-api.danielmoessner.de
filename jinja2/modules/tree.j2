{% import "modules/todo.j2" as tg %}


{% macro todo_tree(todos, url_prefix='') %}
  {% for todo in todos %}
    <li class="tree--li">
      <span class="tree--caret">
        <span class="tree--caret--name"><span class="tree--caret--arrow">&#8623;</span> {{ todo.name }}</span>
        {{ tg.status_pill(todo.status) }}
        <a class="adminator-href-button" href="{{ url('goals:'+url_prefix+'to_do', args=[todo.pk]) }}">Open</a>
      </span>
    </li>
  {% endfor %}
{% endmacro %}


{% macro strategy_tree(strategies) %}
  {% for strategy in strategies %}
    <li class="tree--li">
            <span class="tree--caret"><span class="tree--caret--name"><span class="tree--caret--arrow">&#8605;</span> {{ strategy.name }}</span>
                <span class="blue-badge">{{ strategy.progress }} %</span>
                <a class="adminator-href-button" href="{{ url('goals:strategy', args=[strategy.pk]) }}">Open</a>
            </span>
            <ul class="tree--nested">{{ todo_tree(strategy.normaltodos) }}</ul>
            <ul class="tree--nested">{{ todo_tree(strategy.repetitivetodos, url_prefix='repetitive_') }}</ul>
            <ul class="tree--nested">{{ todo_tree(strategy.neverendingtodos, url_prefix='never_ending_') }}</ul>
            <ul class="tree--nested">{{ todo_tree(strategy.pipelinetodos, url_prefix='pipeline_') }}</ul>
            <ul class="tree--nested">{{ todo_tree(strategy.multipletodos, url_prefix='multiple_') }}</ul>
        </li>
  {% endfor %}
{% endmacro %}


{% macro monitor_tree(monitors) %}
  {% for monitor in monitors %}
    <li class="tree--li">
      <div class="tree--caret">
        <span class="tree--caret--name"><span class="tree--caret--arrow">&#8613;</span> {{ monitor.name }}</span>
          <span class="blue-badge">{{ monitor.progress }} %</span>
          <a class="adminator-href-button" href="{{ url('goals:progress_monitor', args=[monitor.pk]) }}">Open</a>
      </div>
    </li>
  {% endfor %}
{% endmacro %}


{% macro goal_tree(goals) %}
  {% for goal in goals %}
    <li class="tree--li">
      <span class="tree--caret">
        <span class="tree--caret--name"><span class="tree--caret--arrow">&#8611;</span> {{ goal.name }}</span>
        <span class="blue-badge">{{ goal.progress }} %</span>
        <a class="adminator-href-button" href="{{ url('goals:goal', args=[goal.pk]) }}">Open</a>
      </span>
      <ul class="tree--nested">{{ monitor_tree(goal.monitors) }}</ul>
      <ul class="tree--nested">{{ goal_tree(goal.subgoals) }}</ul>
      <ul class="tree--nested">{{ strategy_tree(goal.strategies) }}</ul>
    </li>
  {% endfor %}
{% endmacro %}
